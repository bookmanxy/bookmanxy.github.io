---
layout: post
title:  "网络（三）--TCP"
categories: java基础
tags:  网络 TCP/IP
author: watermelon
---
* content
{:toc}

![网络--TCP](https://images.gitee.com/uploads/images/2019/0127/135438_f52a58c8_1210188.jpeg)
## 前言
网络模块中整理收录UDP相关内容






### 1：为什么
三次握手，四次挥手机制


### 2：是什么
TCP（Transmission Control Protocol 传输控制协议）是一种面向连接的、可靠的、基于字节流(流就是指不间断的数据结构，你可以把它想象成排水管中的水流)的传输层通信协议，由 IETF 的RFC 793定义。TCP 是面向连接的、可靠的流协议。
TCP 为了保证报文传输的可靠，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。    
然后接收端实体对已成功收到的字节发回一个相应的确认(ACK)；如果发送端实体在合理的往返时延(RTT)内未收到确认，那么对应的数据（假设丢失了）将会被重传。    
  
TCP是因特网中的传输层协议，使用三次握手协议建立连接。
当主动方发出SYN连接请求后，等待对方回答 SYN + ACK ，并最终对对方的 SYN 执行 ACK 确认。
这种建立连接的方法可以防止产生错误的连接，TCP 使用的流量控制协议是可变大小的滑动窗口协议。

##### 连接建立
![三次握手](https://images.gitee.com/uploads/images/2019/0127/175019_dce09daa_1210188.jpeg)

* 1、客户端发送 SYN（SEQ=x）报文给服务器端，进入 SYN_SEND 状态。
* 2、服务器端收到 SYN 报文，回应一个 SYN （SEQ=y）ACK(ACK=x+1）报文，进入 SYN_RECV 状态。
* 3、客户端收到服务器端的 SYN 报文，回应一个 ACK(ACK=y+1）报文，进入 Established 状态。

三次握手完成，TCP客户端和服务器端成功地建立连接，可以开始传输数据了。

##### 连接终止
![四次挥手](https://images.gitee.com/uploads/images/2019/0127/175159_76b82bdd_1210188.jpeg)

* 1、某个应用进程首先调用 close，称该端执行“主动关闭”（active close）。该端的 TCP 于是发送一个 FIN 分节，表示数据发送完毕。
* 2、接收到这个 FIN 的对端执行 “被动关闭”（passive close），这个 FIN 由 TCP 确认。 
```text
注意：FIN 的接收也作为一个文件结束符（end-of-file）传递给接收端应用进程，放在已排队等候该应用进程接收的任何其他数据之后，因为，FIN 的接收意味着接收端应用进程在相应连接上再无额外数据可接收。
```

* 3、一段时间后，接收到这个文件结束符的应用进程将调用 close 关闭它的套接字。这导致它的 TCP 也发送一个 FIN。
* 4、接收这个最终FIN的原发送端 TCP（即执行主动关闭的那一端）确认这个 FIN。 既然每个方向都需要一个 FIN 和一个 ACK，因此通常需要4个分节。

无论是客户还是服务器，任何一端都可以执行主动关闭。通常情况是，客户执行主动关闭，但是某些协议，例如，HTTP/1.0却由服务器执行主动关闭。

### 3：怎么用
下面有模板代码，很详细

### 4：跟UDP区别及优缺点
* 1：最大的区别就是：TCP是有连接的；UDP是无连接的

TCP的优点： 可靠，稳定 TCP的可靠体现在TCP在传递数据之前，会有三次握手来建立连接，而且在数据传递时，有确认、窗口、重传、拥塞控制机制，在数据传完后，还会断开连接用来节约系统资源。 TCP的缺点： 慢，效率低，占用系统资源高，易被攻击 TCP在传递数据之前，要先建连接，这会消耗时间，而且在数据传递时，确认机制、重传机制、拥塞控制机制等都会消耗大量的时间，而且要在每台设备上维护所有的传输连接，事实上，每个连接都会占用系统的CPU、内存等硬件资源。 而且，因为TCP有确认机制、三次握手机制，这些也导致TCP容易被人利用，实现DOS、DDOS、CC等攻击。  
UDP的优点： 快，比TCP稍安全 UDP没有TCP的握手、确认、窗口、重传、拥塞控制等机制，UDP是一个无状态的传输协议，所以它在传递数据时非常快。没有TCP的这些机制，UDP较TCP被攻击者利用的漏洞就要少一些。但UDP也是无法避免攻击的，比如：UDP Flood攻击…… UDP的缺点： 不可靠，不稳定 因为UDP没有TCP那些可靠的机制，在数据传递时，如果网络质量不好，就会很容易丢包。 基于上面的优缺点，那么： 什么时候应该使用TCP： 当对网络通讯质量有要求的时候，比如：整个数据要准确无误的传递给对方，这往往用于一些要求可靠的应用，比如HTTP、HTTPS、FTP等传输文件的协议，POP、SMTP等邮件传输的协议。 在日常生活中，常见使用TCP协议的应用如下： 浏览器，用的HTTP FlashFXP，用的FTP Outlook，用的POP、SMTP Putty，用的Telnet、SSH QQ文件传输 ………… 什么时候应该使用UDP： 当对网络通讯质量要求不高的时候，要求网络通讯速度能尽量的快，这时就可以使用UDP。 比如，日常生活中，常见使用UDP协议的应用如下： QQ语音 QQ视频 TFTP ……  

有些应用场景对可靠性要求不高会用到UPD，比如长视频，要求速率

* 小结TCP与UDP的区别：

1.基于连接与无连接；  
2.对系统资源的要求（TCP较多，UDP少）；  
3.UDP程序结构较简单；  
4.流模式与数据报模式 ；  
5.TCP保证数据正确性，UDP可能丢包，TCP保证数据顺序，UDP不保证。  


  
引用：
 [有模板代码：很详细！《java中TCP传输协议》](https://www.cnblogs.com/brucemengbm/p/7015966.html)  


